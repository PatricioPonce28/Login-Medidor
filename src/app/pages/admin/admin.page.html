<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Panel Administrador</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="logout()">
        <ion-icon name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  
  <!-- Bienvenida -->
  <ion-card>
    <ion-card-content>
      <h2>¡Hola, {{userName}}!</h2>
      <p>Total de mediciones en el sistema: <strong>{{totalMediciones}}</strong></p>
    </ion-card-content>
  </ion-card>

  <!-- Botones de Acciones -->
  <ion-grid>
    <ion-row>
      <ion-col size="6">
        <ion-button 
          expand="block" 
          routerLink="/registro-medidor">
          <ion-icon name="person-add-outline" slot="start"></ion-icon>
          Registrar Medidor
        </ion-button>
      </ion-col>
      <ion-col size="6">
        <ion-button 
          expand="block" 
          color="secondary"
          routerLink="/registro-admin">
          <ion-icon name="shield-checkmark-outline" slot="start"></ion-icon>
          Registrar Admin
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Lista de Todas las Mediciones -->
<ion-card>
  <ion-card-header>
    <ion-card-title>Todas las Mediciones</ion-card-title>
  </ion-card-header>
</ion-card>

<ion-card *ngIf="todasMediciones.length === 0">
  <ion-card-content>
    <p class="ion-text-center">No hay mediciones registradas</p>
  </ion-card-content>
</ion-card>

<ion-accordion-group>
  <ion-accordion *ngFor="let medicion of todasMediciones; let i = index" [value]="'medicion-' + i">
    
    <ion-item slot="header" color="light">
      <ion-label>
        <h2><strong>Valor: {{medicion.valorMedidor}}</strong></h2>
        <p>
          <ion-icon name="person-outline"></ion-icon> {{medicion.userName}}
        </p>
        <p>
          <ion-icon name="time-outline"></ion-icon> {{formatearFecha(medicion.fechaRegistro)}}
        </p>
      </ion-label>
    </ion-item>

    <div class="ion-padding" slot="content">
      
      <!-- Observaciones -->
      <div *ngIf="medicion.observaciones" class="info-section">
        <p><strong>Observaciones:</strong></p>
        <p class="text-muted">{{medicion.observaciones}}</p>
      </div>

      <!-- Ubicación -->
      <div class="info-section">
        <p><strong>Ubicación:</strong></p>
        <p class="text-muted">
          Lat: {{medicion.latitud.toFixed(6)}}<br>
          Lng: {{medicion.longitud.toFixed(6)}}
        </p>
      </div>

      <!-- Botones de acción -->
      <ion-grid>
        <ion-row>
          <ion-col size="12" size-md="6">
            <ion-button 
              size="small"
              expand="block" 
              fill="outline"
              color="primary"
              (click)="abrirGoogleMaps(medicion.googleMapsUrl)">
              <ion-icon name="map-outline" slot="start"></ion-icon>
              Ver en Maps
            </ion-button>
          </ion-col>
          <ion-col size="12" size-md="6">
            <ion-button 
              size="small"
              expand="block" 
              color="danger"
              (click)="confirmarEliminar(medicion)">
              <ion-icon name="trash-outline" slot="start"></ion-icon>
              Eliminar
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>

      <!-- Grid de Fotos -->
      <ion-grid class="fotos-grid">
        <ion-row>
          <ion-col size="6">
            <div class="foto-container">
              <p class="foto-label">Medidor</p>
              <img [src]="medicion.fotoMedidor" (click)="verImagenCompleta(medicion.fotoMedidor)">
            </div>
          </ion-col>
          <ion-col size="6">
            <div class="foto-container">
              <p class="foto-label">Fachada</p>
              <img [src]="medicion.fotoFachada" (click)="verImagenCompleta(medicion.fotoFachada)">
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>

    </div>
  </ion-accordion>
</ion-accordion-group>

</ion-content>